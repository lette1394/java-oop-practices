package com.github.lette1394.calculator2;

import static com.github.lette1394.calculator2.TestFixtures.subjectString;
import static org.junit.jupiter.api.Assertions.assertThrows;

import com.github.lette1394.calculator2.expression.DelayedExpression;
import com.github.lette1394.calculator2.expression.EvaluationTimeoutException;
import com.github.lette1394.calculator2.expression.Expression;
import com.github.lette1394.calculator2.expression.NumericExpressionFactory;
import com.github.lette1394.calculator2.expression.PreemptiveTimeoutExpression;
import java.time.Duration;
import org.junit.jupiter.api.Test;

class TimeoutTest {

  @Test
  void time1() {
    final Expression expression = new DelayedExpression(
      NumericExpressionFactory.INSTANCE.of("12345"), Duration.ofMillis(500));

    new PreemptiveTimeoutExpression(expression, Duration.ofSeconds(1)).evaluate();
  }

  @Test
  void longtime() {
    assertThrows(EvaluationTimeoutException.class, () -> subjectString(aHugeMultiplyExpression()));
  }

  private String aHugeMultiplyExpression() {
    return "1"
      + " + 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " + 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " + 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " + 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321"
      + " * 987654321987654321987654321987654321987654321987654321987654321987654321987654321987654321";
  }
}